# =====================================================
# VORON CHAMBER LIGHTING SYSTEM - COMPLETE CONFIGURATION
# WS2812B NeoPixel Strip: 125 LEDs total
# Right: 42 LEDs (1-42), Center: 42 LEDs (43-84), Left: 41 LEDs (85-125)
# Connected to PF12 (RGB1) on BTT Kraken board
# =====================================================

[neopixel chamber_lights]
pin: PF12
chain_count: 125
color_order: GRB
initial_RED: 0.0
initial_GREEN: 0.0
initial_BLUE: 0.0

#===========================================
# IDLE MACRO - 25% warm white background, 75% rainbow (STATIC VERSION)
#===========================================
[gcode_macro LIGHTS_IDLE]
gcode:
    # Set all LEDs - 25% white, 75% rainbow (static pattern)
    {% for i in range(1, 125) %}
        {% set led_index = i - 1 %}
        {% if led_index % 4 == 0 %}
            # White background (25% of LEDs)
            SET_LED LED=chamber_lights RED=0.2 GREEN=0.175 BLUE=0.125 INDEX={i} TRANSMIT=1
        {% else %}
            # Rainbow colors (75% of LEDs) - static pattern
            {% set color_index = (led_index // 2) % 12 %}
            {% if color_index == 0 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.0 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 1 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.25 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 2 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.5 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 3 %}
                SET_LED LED=chamber_lights RED=0.25 GREEN=0.5 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 4 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.5 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 5 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.5 BLUE=0.25 INDEX={i} TRANSMIT=1
            {% elif color_index == 6 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.5 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% elif color_index == 7 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.25 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% elif color_index == 8 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.0 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% elif color_index == 9 %}
                SET_LED LED=chamber_lights RED=0.25 GREEN=0.0 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% elif color_index == 10 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.0 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% else %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.0 BLUE=0.25 INDEX={i} TRANSMIT=1
            {% endif %}
        {% endif %}
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=0
    M117 Chamber Lights: IDLE

# Flowing animation version (add this later once static works)
[gcode_macro LIGHTS_IDLE_FLOWING]
variable_flow_position: 0
gcode:
    # Start the flowing rainbow effect
    SET_GCODE_VARIABLE MACRO=LIGHTS_IDLE_FLOWING VARIABLE=flow_position VALUE=0
    UPDATE_DELAYED_GCODE ID=idle_flow_cycle DURATION=0.5
    M117 Chamber Lights: IDLE FLOWING

# Flowing rainbow animation for IDLE
[delayed_gcode idle_flow_cycle]
gcode:
    {% set macro = printer["gcode_macro LIGHTS_IDLE"] %}
    {% set pos = macro.flow_position %}
    
    # Calculate rainbow colors based on position
    {% set rainbow_colors = [
        [0.5, 0.0, 0.0],    # Red
        [0.5, 0.25, 0.0],   # Orange  
        [0.5, 0.5, 0.0],    # Yellow
        [0.25, 0.5, 0.0],   # Yellow-Green
        [0.0, 0.5, 0.0],    # Green
        [0.0, 0.5, 0.25],   # Green-Cyan
        [0.0, 0.5, 0.5],    # Cyan
        [0.0, 0.25, 0.5],   # Cyan-Blue
        [0.0, 0.0, 0.5],    # Blue
        [0.25, 0.0, 0.5],   # Blue-Purple
        [0.5, 0.0, 0.5],    # Purple
        [0.5, 0.0, 0.25]    # Purple-Red
    ] %}
    
    # Set all LEDs - 25% white, 75% flowing rainbow
    {% for i in range(1, 125) %}
        {% set led_index = i - 1 %}
        {% if (led_index + pos) % 4 == 0 %}
            # White background (25% of LEDs)
            SET_LED LED=chamber_lights RED=0.2 GREEN=0.175 BLUE=0.125 INDEX={i} TRANSMIT=1
        {% else %}
            # Rainbow colors (75% of LEDs) - flowing effect
            {% set color_index = ((led_index + pos) // 2) % rainbow_colors|length %}
            {% set color = rainbow_colors[color_index] %}
            SET_LED LED=chamber_lights RED={color[0]} GREEN={color[1]} BLUE={color[2]} INDEX={i} TRANSMIT=1
        {% endif %}
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=0
    
    # Update position for next cycle (creates flowing effect)
    SET_GCODE_VARIABLE MACRO=LIGHTS_IDLE VARIABLE=flow_position VALUE={(pos + 1) % 48}
    
    # Continue the flow (only if we're still in IDLE mode)
    UPDATE_DELAYED_GCODE ID=idle_flow_cycle DURATION=0.5

#===========================================
# HOMING MACRO - Slow breathing yellowish white (sides only)
#===========================================
[gcode_macro LIGHTS_HOMING]
variable_breathing_state: 0
gcode:
    # Stop idle flow and set static center pattern
    UPDATE_DELAYED_GCODE ID=idle_flow_cycle DURATION=0
    {% for i in range(43, 85) %}
        {% if (i - 43) % 4 == 0 %}
            # White background spots
            SET_LED LED=chamber_lights RED=0.2 GREEN=0.175 BLUE=0.125 INDEX={i} TRANSMIT=1
        {% else %}
            # Static rainbow colors for center during homing
            {% set color_index = ((i - 43) // 2) % 12 %}
            {% if color_index == 0 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.0 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 1 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.25 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 2 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.5 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 3 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.5 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 4 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.5 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% elif color_index == 5 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.0 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% else %}
                SET_LED LED=chamber_lights RED=0.25 GREEN=0.0 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% endif %}
        {% endif %}
    {% endfor %}
    
    # Breathing yellowish white on sides - start with dim
    {% for i in range(1, 43) %}
        SET_LED LED=chamber_lights RED=0.3 GREEN=0.25 BLUE=0.1 INDEX={i} TRANSMIT=1
    {% endfor %}
    {% for i in range(85, 125) %}
        SET_LED LED=chamber_lights RED=0.3 GREEN=0.25 BLUE=0.1 INDEX={i} TRANSMIT=1
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=0
    M117 Chamber Lights: HOMING
    
    # Start breathing cycle
    UPDATE_DELAYED_GCODE ID=breathing_cycle DURATION=2

# Breathing cycle for smooth transitions
[delayed_gcode breathing_cycle]
gcode:
    {% set macro = printer["gcode_macro LIGHTS_HOMING"] %}
    {% if macro.breathing_state == 0 %}
        # Breathe up
        {% for i in range(1, 43) %}
            SET_LED LED=chamber_lights RED=0.5 GREEN=0.4 BLUE=0.15 INDEX={i} TRANSMIT=1
        {% endfor %}
        {% for i in range(85, 125) %}
            SET_LED LED=chamber_lights RED=0.5 GREEN=0.4 BLUE=0.15 INDEX={i} TRANSMIT=1
        {% endfor %}
        SET_LED LED=chamber_lights TRANSMIT=0
        SET_GCODE_VARIABLE MACRO=LIGHTS_HOMING VARIABLE=breathing_state VALUE=1
        UPDATE_DELAYED_GCODE ID=breathing_cycle DURATION=3
    {% else %}
        # Breathe down
        {% for i in range(1, 43) %}
            SET_LED LED=chamber_lights RED=0.3 GREEN=0.25 BLUE=0.1 INDEX={i} TRANSMIT=1
        {% endfor %}
        {% for i in range(85, 125) %}
            SET_LED LED=chamber_lights RED=0.3 GREEN=0.25 BLUE=0.1 INDEX={i} TRANSMIT=1
        {% endfor %}
        SET_LED LED=chamber_lights TRANSMIT=0
        SET_GCODE_VARIABLE MACRO=LIGHTS_HOMING VARIABLE=breathing_state VALUE=0
        UPDATE_DELAYED_GCODE ID=breathing_cycle DURATION=3
    {% endif %}

#===========================================
# QGL MACRO - Scanning blue/white pattern (sides only)
#===========================================
[gcode_macro LIGHTS_QGL]
gcode:
    # Stop idle flow and set static center pattern
    UPDATE_DELAYED_GCODE ID=idle_flow_cycle DURATION=0
    {% for i in range(43, 85) %}
        {% if (i - 43) % 4 == 0 %}
            # White background spots
            SET_LED LED=chamber_lights RED=0.2 GREEN=0.175 BLUE=0.125 INDEX={i} TRANSMIT=1
        {% else %}
            # Static rainbow colors for center
            {% set color_index = ((i - 43) // 2) % 12 %}
            {% if color_index == 0 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.0 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 1 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.25 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 2 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.5 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 3 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.5 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 4 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.5 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% elif color_index == 5 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.0 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% else %}
                SET_LED LED=chamber_lights RED=0.25 GREEN=0.0 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% endif %}
        {% endif %}
    {% endfor %}
    
    # Scanning blue pattern on sides
    {% for i in range(1, 43) %}
        SET_LED LED=chamber_lights RED=0.0 GREEN=0.15 BLUE=0.5 INDEX={i} TRANSMIT=1
    {% endfor %}
    {% for i in range(85, 125) %}
        SET_LED LED=chamber_lights RED=0.0 GREEN=0.15 BLUE=0.5 INDEX={i} TRANSMIT=1
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=0
    M117 Chamber Lights: QGL

#===========================================
# BED MESH MACRO - Pulsing purple (sides only)  
#===========================================
[gcode_macro LIGHTS_BED_MESH]
gcode:
    # Stop idle flow and set static center pattern
    UPDATE_DELAYED_GCODE ID=idle_flow_cycle DURATION=0
    {% for i in range(43, 85) %}
        {% if (i - 43) % 4 == 0 %}
            # White background spots
            SET_LED LED=chamber_lights RED=0.2 GREEN=0.175 BLUE=0.125 INDEX={i} TRANSMIT=1
        {% else %}
            # Static rainbow colors for center
            {% set color_index = ((i - 43) // 2) % 12 %}
            {% if color_index == 0 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.0 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 1 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.25 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 2 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.5 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 3 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.5 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 4 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.5 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% elif color_index == 5 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.0 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% else %}
                SET_LED LED=chamber_lights RED=0.25 GREEN=0.0 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% endif %}
        {% endif %}
    {% endfor %}
    
    # Purple pulsing on sides
    {% for i in range(1, 43) %}
        SET_LED LED=chamber_lights RED=0.4 GREEN=0.1 BLUE=0.5 INDEX={i} TRANSMIT=1
    {% endfor %}
    {% for i in range(85, 125) %}
        SET_LED LED=chamber_lights RED=0.4 GREEN=0.1 BLUE=0.5 INDEX={i} TRANSMIT=1
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=0
    M117 Chamber Lights: BED MESH

#===========================================
# HEATING MACRO - Breathing fire colors (sides only)
#===========================================
[gcode_macro LIGHTS_HEATING]
gcode:
    # Stop idle flow and set static center pattern
    UPDATE_DELAYED_GCODE ID=idle_flow_cycle DURATION=0
    {% for i in range(43, 85) %}
        {% if (i - 43) % 4 == 0 %}
            # White background spots
            SET_LED LED=chamber_lights RED=0.2 GREEN=0.175 BLUE=0.125 INDEX={i} TRANSMIT=1
        {% else %}
            # Static rainbow colors for center
            {% set color_index = ((i - 43) // 2) % 12 %}
            {% if color_index == 0 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.0 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 1 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.25 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 2 %}
                SET_LED LED=chamber_lights RED=0.5 GREEN=0.5 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 3 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.5 BLUE=0.0 INDEX={i} TRANSMIT=1
            {% elif color_index == 4 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.5 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% elif color_index == 5 %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.0 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% else %}
                SET_LED LED=chamber_lights RED=0.25 GREEN=0.0 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% endif %}
        {% endif %}
    {% endfor %}
    
    # Fire breathing on sides
    {% for i in range(1, 43) %}
        SET_LED LED=chamber_lights RED=0.5 GREEN=0.15 BLUE=0.0 INDEX={i} TRANSMIT=1
    {% endfor %}
    {% for i in range(85, 125) %}
        SET_LED LED=chamber_lights RED=0.5 GREEN=0.15 BLUE=0.0 INDEX={i} TRANSMIT=1
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=0
    M117 Chamber Lights: HEATING

#===========================================
# PRINTING MACRO - Reddish white 50% brightness + Progress bar setup
#===========================================
[gcode_macro LIGHTS_PRINTING]
gcode:
    # Sides: Reddish white at 50% brightness
    {% for i in range(1, 43) %}
        SET_LED LED=chamber_lights RED=0.25 GREEN=0.175 BLUE=0.125 INDEX={i} TRANSMIT=1
    {% endfor %}
    {% for i in range(85, 125) %}
        SET_LED LED=chamber_lights RED=0.25 GREEN=0.175 BLUE=0.125 INDEX={i} TRANSMIT=1
    {% endfor %}
    # Center: White background for progress bar
    {% for i in range(43, 85) %}
        SET_LED LED=chamber_lights RED=0.15 GREEN=0.15 BLUE=0.15 INDEX={i} TRANSMIT=1
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=0
    M117 Chamber Lights: PRINTING

#===========================================
# PRINT PROGRESS MACRO - Updates center strip with progress (LEFT TO RIGHT)
#===========================================
[gcode_macro LIGHTS_PRINT_PROGRESS]
gcode:
    {% set progress = params.PROGRESS|default(0)|float %}
    {% set progress_leds = (progress / 100 * 42)|int %}
    
    {% for i in range(1, 42) %}
        SET_LED LED=chamber_lights RED=1 GREEN=0.75 BLUE=0.75 INDEX={i} TRANSMIT=1
    {% endfor %}

    {% for i in range(86, 125) %}
        SET_LED LED=chamber_lights RED=1 GREEN=0.75 BLUE=0.75 INDEX={i} TRANSMIT=1
    {% endfor %}
    
    # Center strip background (dim white)
    {% for i in range(43, 85) %}
        SET_LED LED=chamber_lights RED=0.15 GREEN=0.15 BLUE=0.15 INDEX={i} TRANSMIT=1
    {% endfor %}
    
    # Progress bar (blue) from LEFT to RIGHT (43 up to 84)
    {% for i in range(43, 43 + progress_leds) %}
        SET_LED LED=chamber_lights RED=0.0 GREEN=0.25 BLUE=0.75 INDEX={i} TRANSMIT=1
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=0

#===========================================
# PRINT COMPLETE MACRO - Subtle strobing center strip for 20 seconds
#===========================================
[gcode_macro LIGHTS_PRINT_COMPLETE]
variable_strobe_state: 0
variable_strobe_count: 0
gcode:
    # Keep sides in printing mode (reddish white)
    {% for i in range(1, 43) %}
        SET_LED LED=chamber_lights RED=0.25 GREEN=0.175 BLUE=0.125 INDEX={i} TRANSMIT=1
    {% endfor %}
    {% for i in range(85, 125) %}
        SET_LED LED=chamber_lights RED=0.25 GREEN=0.175 BLUE=0.125 INDEX={i} TRANSMIT=1
    {% endfor %}
    
    # Center strip: Start with full blue (100% progress)
    {% for i in range(43, 85) %}
        SET_LED LED=chamber_lights RED=0.0 GREEN=0.15 BLUE=0.5 INDEX={i} TRANSMIT=1
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=0
    
    M117 Print Complete! Celebrating...
    SET_GCODE_VARIABLE MACRO=LIGHTS_PRINT_COMPLETE VARIABLE=strobe_count VALUE=0
    SET_GCODE_VARIABLE MACRO=LIGHTS_PRINT_COMPLETE VARIABLE=strobe_state VALUE=0
    UPDATE_DELAYED_GCODE ID=complete_strobe_cycle DURATION=1.0

# Print complete strobing cycle (20 seconds total = ~20 cycles)
[delayed_gcode complete_strobe_cycle]
gcode:
    {% set macro = printer["gcode_macro LIGHTS_PRINT_COMPLETE"] %}
    {% set count = macro.strobe_count %}
    {% set state = macro.strobe_state %}
    
    {% if count < 20 %}  # Run for 20 cycles (20 seconds)
        {% if state == 0 %}
            # Strobe up - brighter blue
            {% for i in range(43, 85) %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.25 BLUE=0.7 INDEX={i} TRANSMIT=1
            {% endfor %}
            SET_LED LED=chamber_lights TRANSMIT=0
            SET_GCODE_VARIABLE MACRO=LIGHTS_PRINT_COMPLETE VARIABLE=strobe_state VALUE=1
            UPDATE_DELAYED_GCODE ID=complete_strobe_cycle DURATION=1.0
        {% else %}
            # Strobe down - normal blue
            {% for i in range(43, 85) %}
                SET_LED LED=chamber_lights RED=0.0 GREEN=0.15 BLUE=0.5 INDEX={i} TRANSMIT=1
            {% endfor %}
            SET_LED LED=chamber_lights TRANSMIT=0
            SET_GCODE_VARIABLE MACRO=LIGHTS_PRINT_COMPLETE VARIABLE=strobe_state VALUE=0
            SET_GCODE_VARIABLE MACRO=LIGHTS_PRINT_COMPLETE VARIABLE=strobe_count VALUE={count + 1}
            UPDATE_DELAYED_GCODE ID=complete_strobe_cycle DURATION=1.0
        {% endif %}
    {% else %}
        # Celebration complete - show final state
        M117 Print Complete!
    {% endif %}

#===========================================
# PAUSED MACRO - Subtle strobing (sides only)
#===========================================
[gcode_macro LIGHTS_PAUSED]
variable_strobe_state: 0
gcode:
    # Center keeps progress display unchanged
    # Sides: Start gentle orange strobe
    {% for i in range(1, 43) %}
        SET_LED LED=chamber_lights RED=0.3 GREEN=0.15 BLUE=0.0 INDEX={i} TRANSMIT=1
    {% endfor %}
    {% for i in range(85, 125) %}
        SET_LED LED=chamber_lights RED=0.3 GREEN=0.15 BLUE=0.0 INDEX={i} TRANSMIT=1
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=0
    M117 Chamber Lights: PAUSED
    UPDATE_DELAYED_GCODE ID=strobe_cycle DURATION=1.5

# Subtle strobing cycle
[delayed_gcode strobe_cycle]
gcode:
    {% set macro = printer["gcode_macro LIGHTS_PAUSED"] %}
    {% if macro.strobe_state == 0 %}
        # Strobe up (gentle)
        {% for i in range(1, 43) %}
            SET_LED LED=chamber_lights RED=0.4 GREEN=0.2 BLUE=0.0 INDEX={i} TRANSMIT=1
        {% endfor %}
        {% for i in range(85, 125) %}
            SET_LED LED=chamber_lights RED=0.4 GREEN=0.2 BLUE=0.0 INDEX={i} TRANSMIT=1
        {% endfor %}
        SET_LED LED=chamber_lights TRANSMIT=0
        SET_GCODE_VARIABLE MACRO=LIGHTS_PAUSED VARIABLE=strobe_state VALUE=1
        UPDATE_DELAYED_GCODE ID=strobe_cycle DURATION=1.5
    {% else %}
        # Strobe down
        {% for i in range(1, 43) %}
            SET_LED LED=chamber_lights RED=0.3 GREEN=0.15 BLUE=0.0 INDEX={i} TRANSMIT=1
        {% endfor %}
        {% for i in range(85, 125) %}
            SET_LED LED=chamber_lights RED=0.3 GREEN=0.15 BLUE=0.0 INDEX={i} TRANSMIT=1
        {% endfor %}
        SET_LED LED=chamber_lights TRANSMIT=0
        SET_GCODE_VARIABLE MACRO=LIGHTS_PAUSED VARIABLE=strobe_state VALUE=0
        UPDATE_DELAYED_GCODE ID=strobe_cycle DURATION=1.5
    {% endif %}

#===========================================
# LIGHTS OFF MACRO
#===========================================
[gcode_macro LIGHTS_OFF]
gcode:
    STOP_LIGHT_EFFECTS
    SET_LED LED=chamber_lights RED=0 GREEN=0 BLUE=0
    M117 Chamber Lights: OFF

#===========================================
# STOP ALL LIGHTING EFFECTS
#===========================================
[gcode_macro STOP_LIGHT_EFFECTS]
gcode:
    UPDATE_DELAYED_GCODE ID=breathing_cycle DURATION=0
    UPDATE_DELAYED_GCODE ID=strobe_cycle DURATION=0
    UPDATE_DELAYED_GCODE ID=complete_strobe_cycle DURATION=0
    UPDATE_DELAYED_GCODE ID=idle_flow_cycle DURATION=0

#===========================================
# INTEGRATION MACROS FOR PRINTER OPERATIONS
#===========================================
[gcode_macro G28]
rename_existing: G28.1
gcode:
    STOP_LIGHT_EFFECTS
    LIGHTS_HOMING
    G28.1 {rawparams}
    STOP_LIGHT_EFFECTS
    LIGHTS_IDLE

[gcode_macro QUAD_GANTRY_LEVEL]
rename_existing: QUAD_GANTRY_LEVEL.1
gcode:
    STOP_LIGHT_EFFECTS
    LIGHTS_QGL
    QUAD_GANTRY_LEVEL.1 {rawparams}
    LIGHTS_IDLE

[gcode_macro BED_MESH_CALIBRATE]
rename_existing: BED_MESH_CALIBRATE.1
gcode:
    STOP_LIGHT_EFFECTS
    LIGHTS_BED_MESH
    BED_MESH_CALIBRATE.1 {rawparams}
    LIGHTS_IDLE

[gcode_macro PAUSE]
rename_existing: PAUSE.1
gcode:
    PAUSE.1
    LIGHTS_PAUSED

[gcode_macro RESUME]
rename_existing: RESUME.1
gcode:
    STOP_LIGHT_EFFECTS
    LIGHTS_PRINTING
    RESUME.1

#===========================================
# HEATING INTEGRATION (optional - add to your heating macros)
#===========================================
# [gcode_macro M109]
# rename_existing: M109.1
# gcode:
#     LIGHTS_HEATING
#     M109.1 {rawparams}
#     LIGHTS_IDLE