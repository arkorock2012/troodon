# Voron Chamber Lighting Configuration for WS2812B Strip
# Total: 125 LEDs - Right: 42, Center: 42, Left: 41
# Connected to PF12 (RGB1) on BTT Kraken

[neopixel chamber_lights]
pin: PF12
chain_count: 125
color_order: GRB
initial_RED: 0.0
initial_GREEN: 0.0
initial_BLUE: 0.0

# LED Index Definitions
# Right strip: LEDs 1-42
# Center strip: LEDs 43-84  
# Left strip: LEDs 85-125

#===========================================
# IDLE MACRO - Rainbow with 75% white, 25% rainbow
#===========================================
[gcode_macro LIGHTS_IDLE]
gcode:
    # Set most LEDs to warm white (75% of strip)
    SET_LED LED=chamber_lights RED=0.8 GREEN=0.7 BLUE=0.5 INDEX=1 TRANSMIT=0
    SET_LED LED=chamber_lights RED=0.8 GREEN=0.7 BLUE=0.5 INDEX=2 TRANSMIT=0
    SET_LED LED=chamber_lights RED=0.8 GREEN=0.7 BLUE=0.5 INDEX=3 TRANSMIT=0
    # Rainbow accents for remaining 25%
    SET_LED LED=chamber_lights RED=1.0 GREEN=0.0 BLUE=0.0 INDEX=10 TRANSMIT=0  # Red
    SET_LED LED=chamber_lights RED=1.0 GREEN=0.5 BLUE=0.0 INDEX=20 TRANSMIT=0  # Orange
    SET_LED LED=chamber_lights RED=1.0 GREEN=1.0 BLUE=0.0 INDEX=30 TRANSMIT=0  # Yellow
    SET_LED LED=chamber_lights RED=0.0 GREEN=1.0 BLUE=0.0 INDEX=40 TRANSMIT=0  # Green
    SET_LED LED=chamber_lights RED=0.0 GREEN=0.0 BLUE=1.0 INDEX=50 TRANSMIT=0  # Blue
    SET_LED LED=chamber_lights RED=0.5 GREEN=0.0 BLUE=1.0 INDEX=60 TRANSMIT=0  # Purple
    SET_LED LED=chamber_lights RED=1.0 GREEN=0.0 BLUE=1.0 INDEX=70 TRANSMIT=0  # Magenta
    SET_LED LED=chamber_lights RED=0.0 GREEN=1.0 BLUE=1.0 INDEX=80 TRANSMIT=0  # Cyan
    SET_LED LED=chamber_lights RED=1.0 GREEN=0.0 BLUE=0.0 INDEX=90 TRANSMIT=0  # Red
    SET_LED LED=chamber_lights RED=0.0 GREEN=1.0 BLUE=0.0 INDEX=100 TRANSMIT=0 # Green
    SET_LED LED=chamber_lights RED=0.0 GREEN=0.0 BLUE=1.0 INDEX=110 TRANSMIT=0 # Blue
    SET_LED LED=chamber_lights RED=1.0 GREEN=1.0 BLUE=0.0 INDEX=120 TRANSMIT=1 # Yellow
    # Fill remaining with warm white
    {% for i in range(4, 126) %}
        {% if i not in [10,20,30,40,50,60,70,80,90,100,110,120] %}
            SET_LED LED=chamber_lights RED=0.8 GREEN=0.7 BLUE=0.5 INDEX={i} TRANSMIT=0
        {% endif %}
    {% endfor %}
    SET_LED LED=chamber_lights RED=0.8 GREEN=0.7 BLUE=0.5 INDEX=125 TRANSMIT=1
    M117 Chamber Lights: IDLE

#===========================================
# HOMING MACRO - Breathing yellowish white (sides only)
#===========================================
[gcode_macro LIGHTS_HOMING]
gcode:
    # Center strip stays in IDLE
    {% for i in range(43, 85) %}
        SET_LED LED=chamber_lights RED=0.8 GREEN=0.7 BLUE=0.5 INDEX={i} TRANSMIT=0
    {% endfor %}
    # Breathing effect on sides - will cycle through brightness levels
    SET_LED LED=chamber_lights RED=1.0 GREEN=0.8 BLUE=0.3 INDEX=1 TRANSMIT=1  # Start breathing
    M117 Chamber Lights: HOMING

#===========================================
# QGL MACRO - Scanning blue/white pattern (sides only)
#===========================================
[gcode_macro LIGHTS_QGL]
gcode:
    # Center strip stays in IDLE
    {% for i in range(43, 85) %}
        SET_LED LED=chamber_lights RED=0.8 GREEN=0.7 BLUE=0.5 INDEX={i} TRANSMIT=0
    {% endfor %}
    # Scanning pattern on sides
    {% for i in range(1, 43) %}
        SET_LED LED=chamber_lights RED=0.0 GREEN=0.3 BLUE=1.0 INDEX={i} TRANSMIT=0
    {% endfor %}
    {% for i in range(85, 126) %}
        SET_LED LED=chamber_lights RED=0.0 GREEN=0.3 BLUE=1.0 INDEX={i} TRANSMIT=0
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=1
    M117 Chamber Lights: QGL

#===========================================
# BED MESH MACRO - Pulsing purple (sides only)  
#===========================================
[gcode_macro LIGHTS_BED_MESH]
gcode:
    # Center strip stays in IDLE
    {% for i in range(43, 85) %}
        SET_LED LED=chamber_lights RED=0.8 GREEN=0.7 BLUE=0.5 INDEX={i} TRANSMIT=0
    {% endfor %}
    # Purple pulsing on sides
    {% for i in range(1, 43) %}
        SET_LED LED=chamber_lights RED=0.8 GREEN=0.2 BLUE=1.0 INDEX={i} TRANSMIT=0
    {% endfor %}
    {% for i in range(85, 126) %}
        SET_LED LED=chamber_lights RED=0.8 GREEN=0.2 BLUE=1.0 INDEX={i} TRANSMIT=0
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=1
    M117 Chamber Lights: BED MESH

#===========================================
# HEATING MACRO - Breathing fire colors (sides only)
#===========================================
[gcode_macro LIGHTS_HEATING]
gcode:
    # Center strip stays in IDLE  
    {% for i in range(43, 85) %}
        SET_LED LED=chamber_lights RED=0.8 GREEN=0.7 BLUE=0.5 INDEX={i} TRANSMIT=0
    {% endfor %}
    # Fire breathing on sides
    {% for i in range(1, 43) %}
        SET_LED LED=chamber_lights RED=1.0 GREEN=0.3 BLUE=0.0 INDEX={i} TRANSMIT=0
    {% endfor %}
    {% for i in range(85, 126) %}
        SET_LED LED=chamber_lights RED=1.0 GREEN=0.3 BLUE=0.0 INDEX={i} TRANSMIT=0
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=1
    M117 Chamber Lights: HEATING

#===========================================
# PRINTING MACRO - Reddish white 50% brightness + Progress bar
#===========================================
[gcode_macro LIGHTS_PRINTING]
gcode:
    # Sides: Reddish white at 50% brightness
    {% for i in range(1, 43) %}
        SET_LED LED=chamber_lights RED=0.5 GREEN=0.35 BLUE=0.25 INDEX={i} TRANSMIT=0
    {% endfor %}
    {% for i in range(85, 126) %}
        SET_LED LED=chamber_lights RED=0.5 GREEN=0.35 BLUE=0.25 INDEX={i} TRANSMIT=0
    {% endfor %}
    # Center: White background for progress bar
    {% for i in range(43, 85) %}
        SET_LED LED=chamber_lights RED=0.3 GREEN=0.3 BLUE=0.3 INDEX={i} TRANSMIT=0
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=1
    M117 Chamber Lights: PRINTING

#===========================================
# PRINT PROGRESS MACRO - Updates center strip with progress
#===========================================
[gcode_macro LIGHTS_PRINT_PROGRESS]
gcode:
    {% set progress = params.PROGRESS|default(0)|float %}
    {% set progress_leds = (progress / 100 * 42)|int %}
    
    # Center strip background (white)
    {% for i in range(43, 85) %}
        SET_LED LED=chamber_lights RED=0.3 GREEN=0.3 BLUE=0.3 INDEX={i} TRANSMIT=0
    {% endfor %}
    
    # Progress bar (blue) from left to right
    {% for i in range(43, 43 + progress_leds) %}
        SET_LED LED=chamber_lights RED=0.0 GREEN=0.3 BLUE=1.0 INDEX={i} TRANSMIT=0
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=1

#===========================================
# PAUSED MACRO - Subtle strobing (sides only)
#===========================================
[gcode_macro LIGHTS_PAUSED]
gcode:
    # Center keeps progress display
    # Sides: Gentle orange strobe
    {% for i in range(1, 43) %}
        SET_LED LED=chamber_lights RED=0.6 GREEN=0.3 BLUE=0.0 INDEX={i} TRANSMIT=0
    {% endfor %}
    {% for i in range(85, 126) %}
        SET_LED LED=chamber_lights RED=0.6 GREEN=0.3 BLUE=0.0 INDEX={i} TRANSMIT=0
    {% endfor %}
    SET_LED LED=chamber_lights TRANSMIT=1
    M117 Chamber Lights: PAUSED

#===========================================
# LIGHTS OFF MACRO
#===========================================
[gcode_macro LIGHTS_OFF]
gcode:
    SET_LED LED=chamber_lights RED=0 GREEN=0 BLUE=0
    M117 Chamber Lights: OFF

#===========================================
# INTEGRATION MACROS FOR PRINTER OPERATIONS
#===========================================
[gcode_macro G28]
rename_existing: G28.1
gcode:
    STOP_LIGHT_EFFECTS
    LIGHTS_HOMING
    G28.1 {rawparams}
    STOP_LIGHT_EFFECTS
    LIGHTS_IDLE

[gcode_macro QUAD_GANTRY_LEVEL]
rename_existing: QUAD_GANTRY_LEVEL.1
gcode:
    STOP_LIGHT_EFFECTS
    LIGHTS_QGL
    QUAD_GANTRY_LEVEL.1 {rawparams}
    LIGHTS_IDLE

[gcode_macro BED_MESH_CALIBRATE]
rename_existing: BED_MESH_CALIBRATE.1
gcode:
    STOP_LIGHT_EFFECTS
    LIGHTS_BED_MESH
    BED_MESH_CALIBRATE.1 {rawparams}
    LIGHTS_IDLE

[gcode_macro PAUSE]
rename_existing: PAUSE.1
gcode:
    PAUSE.1
    LIGHTS_PAUSED

[gcode_macro RESUME]
rename_existing: RESUME.1
gcode:
    STOP_LIGHT_EFFECTS
    LIGHTS_PRINTING
    RESUME.1