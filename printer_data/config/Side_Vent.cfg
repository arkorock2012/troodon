# Servo configuration in printer.cfg
[servo side_vent_servo]
pin: PF11                   # Replace with your actual servo pin
maximum_servo_angle: 180    # Maximum angle your servo can rotate
minimum_pulse_width: 0.0005 # Minimum pulse width (0.5ms)
maximum_pulse_width: 0.0025 # Maximum pulse width (2.5ms)

# Servo ON macro
[gcode_macro SERVO_ON]
gcode:
    SET_SERVO SERVO=side_vent_servo ANGLE=105    # Set servo to ON position (90 degrees)
    M117 Servo ON                        # Display message
    G4 P500                              # Wait 500ms for servo to move

# Servo OFF macro
[gcode_macro SERVO_OFF]
gcode:
    SET_SERVO SERVO=side_vent_servo ANGLE=44     # Set servo to OFF position (0 degrees)
    M117 Servo OFF                       # Display message
    G4 P500                              # Wait 500ms for servo to move

# Toggle servo macro (alternates between ON and OFF)
[gcode_macro SERVO_TOGGLE]
variable_servo_state: 0      # 0 = OFF, 1 = ON
gcode:
    {% if printer["gcode_macro SERVO_TOGGLE"].servo_state == 0 %}
        # Currently OFF, turn ON
        SET_SERVO SERVO=side_vent_servo ANGLE=105
        SET_GCODE_VARIABLE MACRO=SERVO_TOGGLE VARIABLE=servo_state VALUE=1
        M117 Servo ON
    {% else %}
        # Currently ON, turn OFF
        SET_SERVO SERVO=side_vent_servo ANGLE=44
        SET_GCODE_VARIABLE MACRO=SERVO_TOGGLE VARIABLE=servo_state VALUE=0
        M117 Servo OFF
    {% endif %}
    G4 P1000                             # Wait for servo to move

# Servo with custom angle macro
[gcode_macro SERVO_SET]
gcode:
    {% set angle = params.ANGLE|default(90)|int %}
    SET_SERVO SERVO=side_vent_servo ANGLE={angle}
    M117 Servo angle: {angle}
    G4 P500